{"ast":null,"code":"\"use strict\";\n\nconst {\n  EventEmitter\n} = require('node:events');\nconst {\n  getUuc\n} = require('./tiktokUtils');\nconst pkg = require('../../package.json');\nconst axios = require('axios').create({\n  timeout: 5000,\n  headers: {\n    'User-Agent': `${pkg.name}/${pkg.version} ${process.platform}`\n  }\n});\nlet config = {\n  enabled: true,\n  signProviderHost: 'https://tiktok.eulerstream.com/',\n  signProviderFallbackHosts: ['https://tiktok-sign.zerody.one/'],\n  extraParams: {}\n};\nlet signEvents = new EventEmitter();\nfunction signWebcastRequest(url, headers, cookieJar) {\n  return signRequest('webcast/sign_url', url, headers, cookieJar);\n}\nasync function signRequest(providerPath, url, headers, cookieJar) {\n  if (!config.enabled) {\n    return url;\n  }\n  let params = {\n    url,\n    client: 'ttlive-node',\n    ...config.extraParams\n  };\n  params.uuc = getUuc();\n  let signHost;\n  let signResponse;\n  let signError;\n  try {\n    var _signResponse$data;\n    for (signHost of [config.signProviderHost, ...config.signProviderFallbackHosts]) {\n      try {\n        signResponse = await axios.get(signHost + providerPath, {\n          params,\n          responseType: 'json'\n        });\n        if (signResponse.status === 200 && typeof signResponse.data === 'object') {\n          break;\n        }\n      } catch (err) {\n        signError = err;\n      }\n    }\n    if (!signResponse) {\n      throw signError;\n    }\n    if (signResponse.status !== 200) {\n      throw new Error(`Status Code: ${signResponse.status}`);\n    }\n    if (!((_signResponse$data = signResponse.data) !== null && _signResponse$data !== void 0 && _signResponse$data.signedUrl)) {\n      throw new Error('missing signedUrl property');\n    }\n    if (headers) {\n      headers['User-Agent'] = signResponse.data['User-Agent'];\n    }\n    if (cookieJar) {\n      cookieJar.setCookie('msToken', signResponse.data['msToken']);\n    }\n    signEvents.emit('signSuccess', {\n      signHost,\n      originalUrl: url,\n      signedUrl: signResponse.data.signedUrl,\n      headers,\n      cookieJar\n    });\n    return signResponse.data.signedUrl;\n  } catch (error) {\n    signEvents.emit('signError', {\n      signHost,\n      originalUrl: url,\n      headers,\n      cookieJar,\n      error\n    }); // If a sessionid is present, the signature is optional => Do not throw an error.\n\n    if (cookieJar.getCookieByName('sessionid')) {\n      return url;\n    }\n    throw new Error(`Failed to sign request: ${error.message}; URL: ${url}`);\n  }\n}\nmodule.exports = {\n  config,\n  signEvents,\n  signWebcastRequest\n};","map":{"version":3,"names":["EventEmitter","require","getUuc","pkg","axios","create","timeout","headers","name","version","process","platform","config","enabled","signProviderHost","signProviderFallbackHosts","extraParams","signEvents","signWebcastRequest","url","cookieJar","signRequest","providerPath","params","client","uuc","signHost","signResponse","signError","_signResponse$data","get","responseType","status","data","err","Error","signedUrl","setCookie","emit","originalUrl","error","getCookieByName","message","module","exports"],"sources":["/Users/gustavnielsen/Documents/Kode.nosync/tiktokgame/node_modules/tiktok-live-connector/dist/lib/tiktokSignatureProvider.js"],"sourcesContent":["\"use strict\";\n\nconst {\n  EventEmitter\n} = require('node:events');\n\nconst {\n  getUuc\n} = require('./tiktokUtils');\n\nconst pkg = require('../../package.json');\n\nconst axios = require('axios').create({\n  timeout: 5000,\n  headers: {\n    'User-Agent': `${pkg.name}/${pkg.version} ${process.platform}`\n  }\n});\n\nlet config = {\n  enabled: true,\n  signProviderHost: 'https://tiktok.eulerstream.com/',\n  signProviderFallbackHosts: ['https://tiktok-sign.zerody.one/'],\n  extraParams: {}\n};\nlet signEvents = new EventEmitter();\n\nfunction signWebcastRequest(url, headers, cookieJar) {\n  return signRequest('webcast/sign_url', url, headers, cookieJar);\n}\n\nasync function signRequest(providerPath, url, headers, cookieJar) {\n  if (!config.enabled) {\n    return url;\n  }\n\n  let params = {\n    url,\n    client: 'ttlive-node',\n    ...config.extraParams\n  };\n  params.uuc = getUuc();\n  let signHost;\n  let signResponse;\n  let signError;\n\n  try {\n    var _signResponse$data;\n\n    for (signHost of [config.signProviderHost, ...config.signProviderFallbackHosts]) {\n      try {\n        signResponse = await axios.get(signHost + providerPath, {\n          params,\n          responseType: 'json'\n        });\n\n        if (signResponse.status === 200 && typeof signResponse.data === 'object') {\n          break;\n        }\n      } catch (err) {\n        signError = err;\n      }\n    }\n\n    if (!signResponse) {\n      throw signError;\n    }\n\n    if (signResponse.status !== 200) {\n      throw new Error(`Status Code: ${signResponse.status}`);\n    }\n\n    if (!((_signResponse$data = signResponse.data) !== null && _signResponse$data !== void 0 && _signResponse$data.signedUrl)) {\n      throw new Error('missing signedUrl property');\n    }\n\n    if (headers) {\n      headers['User-Agent'] = signResponse.data['User-Agent'];\n    }\n\n    if (cookieJar) {\n      cookieJar.setCookie('msToken', signResponse.data['msToken']);\n    }\n\n    signEvents.emit('signSuccess', {\n      signHost,\n      originalUrl: url,\n      signedUrl: signResponse.data.signedUrl,\n      headers,\n      cookieJar\n    });\n    return signResponse.data.signedUrl;\n  } catch (error) {\n    signEvents.emit('signError', {\n      signHost,\n      originalUrl: url,\n      headers,\n      cookieJar,\n      error\n    }); // If a sessionid is present, the signature is optional => Do not throw an error.\n\n    if (cookieJar.getCookieByName('sessionid')) {\n      return url;\n    }\n\n    throw new Error(`Failed to sign request: ${error.message}; URL: ${url}`);\n  }\n}\n\nmodule.exports = {\n  config,\n  signEvents,\n  signWebcastRequest\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}